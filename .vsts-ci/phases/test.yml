parameters:
  queue:

phases:
- phase: Test_Primary
  displayName: Test Primary

  queue:
    name: ${{ parameters.queue }}
    parallel: 2
    matrix:
      Python27:
        python.version: '2.7'
        python.architecture: x64
      ${{ if eq(parameters.queue, 'Hosted VS2017') }}:
        # TODO remove once Hosted VS2017 has Python 3.7
        Python37:
          python.version: '>= 3.7.0-b2'
          python.architecture: x64

  steps:
  - ${{ if eq(parameters.queue, 'Hosted VS2017') }}:
    - template: ../steps/run-tests-windows.yml

#   - ${{ if ne(parameters.queue, 'Hosted VS2017') }}:
#     - template: ../steps/run-tests.yml

- phase: Test_Secondary
  displayName: Test Secondary
  # Run after Test_Primary so we don't devour time and jobs if tests are going to fail
  dependsOn: Test_Primary

  queue:
    name: ${{ parameters.queue }}
    parallel: 5
    matrix:
      Python34:
        python.version: '3.4'
        python.architecture: x64
      Python35:
        python.version: '3.5'
        python.architecture: x64
      # TODO remove `if` once Hosted VS2017 has Python 3.7
    #   ${{ if ne(parameters.queue, 'Hosted VS2017') }}:
    #     Python37:
    #       python.version: '3.7'
    #       python.architecture: x64
      # On Windows, test x86 builds
      Python36:
        python.version: '3.6'
        python.architecture: x64
        Python27-x86:
          python.version: '2.7'
          python.architecture: x86
        Python36-x86:
          python.version: '3.6'
          python.architecture: x86
        # TODO change to 3.7 once Hosted VS2017 has Python 3.7
        Python37-x86:
          python.version: '>= 3.7.0-b2'
          python.architecture: x86

  steps:
  - ${{ if eq(parameters.queue, 'Hosted VS2017') }}:
    - template: ../steps/run-tests-windows.yml

#   - ${{ if ne(parameters.queue, 'Hosted VS2017') }}:
#     - template: ../steps/run-tests.yml
